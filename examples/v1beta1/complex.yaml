# yaml-language-server: $schema=../../schema.json
namespace: "data-team-pipeline"

defaults:
  severity: ERROR
  daily:
    query_delay: 2h
  time_partitioning: "created_at"
  mode:
    anomaly_engine:
      sensitivity: BALANCED

monitors:
  - id: freshness_on_orders
    type: freshness
    expression: "created_at"
    severity: WARNING
    monitored_ids:
      - ch-prod.anomalies.corrections_v2
      - ch-prod.anomalies.external_sqltests

  - id: volume_on_logs
    type: volume
    severity: WARNING
    monitored_ids:
      - bq-synq-dwh.petr.kernel_assets__stg_assets
    segmentation:
      expression: "country"
    filter: "country IN ('US', 'CA')"

  - id: stats_on_user_fields
    type: field_stats
    fields:
      - status
      - order_date
    monitored_ids:
      - bq-synq-dwh.test.orders
    mode:
      anomaly_engine:
        sensitivity: BALANCED
    daily: {}

  - id: custom_numeric_active_users
    type: custom_numeric
    metric_aggregation: "COUNT(DISTINCT user_id)"
    time_partitioning: "order_date"
    monitored_ids:
      - bq-synq-dwh.test.orders
    mode:
      fixed_thresholds:
        min: 100
        max: 10000
